<div class="modal-overlay" *ngIf="isOpen">
  <div class="modal">
    <div class="modal-header">
      <h2>{{product ? 'Editar Produto' : 'Novo Produto'}}</h2>
      <button class="close-btn" (click)="onClose()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>

    <form (ngSubmit)="onSave()" class="modal-body">
      <div class="form-row">
        <div class="form-group">
          <label>Nome do Produto*</label>
          <input type="text" [(ngModel)]="formData.nome" name="nome" required placeholder="Ex: Lustre Pendente Moderno LED">
        </div>
      </div>

      <div class="form-row two-cols">
        <div class="form-group">
          <label>Categoria*</label>
          <select [(ngModel)]="formData.categoria" name="categoria" required>
            <option *ngFor="let cat of categories" [value]="cat">{{cat}}</option>
          </select>
        </div>
        <div class="form-group">
          <label>Preço (R$)*</label>
          <div class="input-currency">
            <span class="currency-symbol">R$</span>
            <input type="text" [(ngModel)]="precoDisplay" (ngModelChange)="onPrecoChange($event)" name="preco" required placeholder="0,00">
          </div>
        </div>
      </div>

      <div class="form-row two-cols">
        <div class="form-group">
          <label>Estoque Inicial</label>
          <input type="number" [(ngModel)]="formData.estoque" name="estoque" min="0" placeholder="0">
        </div>
        <div class="form-group" *ngIf="product">
          <label>Preço Original</label>
          <div class="input-currency">
            <span class="currency-symbol">R$</span>
            <input type="text" [(ngModel)]="precoOriginalDisplay" (ngModelChange)="onPrecoOriginalChange($event)" name="precoOriginal" placeholder="0,00">
          </div>
        </div>
      </div>

      <div class="form-group">
        <label>Descrição</label>
        <textarea [(ngModel)]="formData.descricao" name="descricao" rows="3" placeholder="Descrição do produto (opcional)"></textarea>
      </div>

      <div class="form-group">
        <label>Imagem do Produto</label>
        <div class="image-upload-container">
          <div class="image-preview" *ngIf="imagePreview || formData.imagem">
            <img [src]="imagePreview || formData.imagem" alt="Preview">
            <button type="button" class="remove-image-btn" (click)="removeImage()">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
          <div class="upload-area" *ngIf="!imagePreview && !formData.imagem" (click)="fileInput.click()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
              <polyline points="17 8 12 3 7 8"/>
              <line x1="12" y1="3" x2="12" y2="15"/>
            </svg>
            <p>Clique para fazer upload da imagem</p>
            <span>PNG, JPG até 5MB</span>
          </div>
          <input
            #fileInput
            type="file"
            accept="image/*"
            (change)="onImageSelected($event)"
            style="display: none">
        </div>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="formData.emDestaque" name="emDestaque">
          <span>Produto em Destaque</span>
          <small>Este produto aparecerá na página inicial</small>
        </label>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-cancel" (click)="onClose()">Cancelar</button>
        <button type="submit" class="btn-save">{{product ? 'Salvar Alterações' : 'Adicionar Produto'}}</button>
      </div>
    </form>
  </div>
</div>
